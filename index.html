<!DOCTYPE html>
<html lang="pt-Br">

<head>
  <meta charset="UTF-8">
 <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="./style.css">
  <link rel="shortcut icon" href="./Assets/M.ico" type="image/x-icon">
  <title>Lista de indica√ß√µes</title>
</head>
<!-- Script que fixa os bot√µes no topo da pagina ao rolar a p√°gina.[Inicio] -->
<script type="text/javascript">
  window.onscroll = scroll;
  function scroll() {
    var nVScroll = document.documentElement.scrollTop || document.body.scrollTop; if (nVScroll > 100) {
      document.getElementById("item1").classList.add('menuFixo');
    } else { document.getElementById("item1").classList.remove('menuFixo'); }
    
  }

  /* Script que fixa os bot√µes no topo da pagina ao rolar a p√°gina.[Fim] */

</script>


<body>

  <section class="container">

    <header class="header-content">

      <div><img class="imgHeader" src="./Assets/LogoMeet-New.png" alt="" srcset=""></div>
      <div>
        <h1>Meet <span>News</span>üóûÔ∏è</h1>
      </div>
      <div><span id="dataHora"></span></div>

    </header>

    <main class="main-content">


      <div id="item1" class="item1">

        <div class="buttons"><img class="imgItem1" src="./Assets/LogoMeet-New.png" width="40" height="40" alt=""
            srcset=""></div>
        <div class="buttons"><button class="btn btnPortaria">Portaria</button></div>
        <div class="buttons"><button class="btn btnIndicacoes">Indica√ß√µes</button></div>
        <div class="buttons"><button class="btn btnAssembleias">Assembleias</button></div>
        <div class="buttons"><button class="btn btnPaterns">Paterns</button></div>

      </div>


      <div class="itens item2">
        <button class="addBtn" onclick="openModalNew(),closeModalUpdate()"><img src="./Assets/btnAdd32.png" alt="" srcset=""></button>
        <!-- Modal para adicionar as noticias na tela [Inicio] -->
        <div class="modalContent" id="showModal">
          <div class="modalAddNews">
           
          <h1>Inserir noticias</h1>

            <input id="data" type="date" name="data" placeholder="Informe a data">

            <input id="titulo" type="text" placeholder="Informe o t√≠tulo">

            <textarea id="conteudo" name="story" rows="20" cols="40" placeholder="Informe o conte√∫do."></textarea>
          
            <div class="adicionar">
            <button id="AddBtn" class="btn">Adicionar</button>
          </div>
          </div>
        </div>
        <!-- Modal para corrigir as noticias na tela [Fim] -->

                <!-- Modal para adicionar as noticias na tela [Inicio] -->
                <div class="modalContent" id="showModalCorrigir">
                  <div class="modalAddNews">
                   
                  <h1>Atualizar noticias</h1>
        
                    <input id="data" type="date" name="data" placeholder="Informe a data">
        
                    <input id="titulo" type="text" placeholder="Informe o t√≠tulo">
        
                    <textarea id="conteudo" name="story" rows="20" cols="40" placeholder="Informe o conte√∫do."></textarea>
                  
                    <div class="adicionar">
                    <button id="AddBtn" class="btn">Adicionar</button>
                  </div>
                  </div>
                </div>
                <!-- Modal para corrigir as noticias na tela [Fim] -->

        <!-- √Årea do conte√∫do da p√°gina -->
        <div id="contentPost" class="post-container"></div>

      </div>

    </main>

    <footer class="footer-content">

      <div>
        <p>Criado <span>voluntariamente</span> para reunir as informa√ß√µes em um mesmo local.</p>
      </div>
      <div>Criado por Vin√≠cius Oliveira ¬Æ.</div>

    </footer>

  </section>
  <script src="./funcoes.js"></script>

  <script type="module">
    // Importa√ß√£o de componentes do banco de dados
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { query, getDatabase, ref, child, get, set, update, remove, orderByKey, orderByChild } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
    import { orderByValue, limitToLast, limitToFirst, equalTo, startAt } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

    // Configura√ß√µes da conex√£o do banco de dados
    const firebaseConfig = {
      apiKey: "AIzaSyBxnFt-BFIPOzLBHGIKCO2OZgNCpx0Ufbo",
      authDomain: "meetnews-1c4bf.firebaseapp.com",
      projectId: "meetnews-1c4bf",
      storageBucket: "meetnews-1c4bf.appspot.com",
      messagingSenderId: "623938736140",
      appId: "1:623938736140:web:5cd1c5529f81c793e15e29"
    };

    // Realiza a conex√£o com o banco
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase();

    // Carrega as os compenentes nas vari√°veis
    let data      = document.getElementById("data");
    let titulo    = document.getElementById('titulo');
    let conteudo  = document.getElementById('conteudo');
    let btn       = document.getElementById('AddBtn');
    let btnRet    = document.getElementById('Retorna');
    let id        = crypto.randomUUID();


    //Fun√ß√£o que grava os dados no banco.
    function addData() {

      let dataFormatada = (new Date(data.value)).toISOString().match(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/)[0].split('-').reverse().join('/');
      console.log(dataFormatada+ ' ' + titulo.value + ' ' + conteudo.value)
    /*  set(ref(db, 'Postagens/' + id), {
        id: id,
        data: dataFormatada,
        titulo: titulo.value,
        conteudo: conteudo.value

      }).then(() => {
        alert("Gravado com sucesso!");
        window.location.reload(true);
      }).catch(() => {
        alert("N√£o gravou! Verifique.");
      })
      */
    }

    //Fun√ß√£o que obtem os dados do banco.
    document.addEventListener('DOMContentLoaded', function RetData() {

      //Constantes que recebem o banco de dados.
      const dbRef = ref(db);
      const recentPostsRef = query(ref(db, 'Postagens/'));

      //Varre os dados do banco.
      get(recentPostsRef)
        .then((snapshot) => {

          //Crio um array que receber√° os valores recebidos do banco.
            var noticias = [];
            var ids = [];
            
          //Percorro o objeto recebido.
            snapshot.forEach(childSnapshot => {
                //Adiciono os dados no array.  
              noticias.push(childSnapshot.val());
              ids.push();
          });

          //Nessa parte eu inverto o array como se fosse um order by desc.
            //noticias.reverse();
            noticias.forEach(element => {         
             

            /* Tratando data [Inicio]. */
            let dataExt = element.data;
            //Extraindo o dia da data  
            let dia = dataExt.slice(0, 2);
            let mes = dataExt.substr(3, 2);
            let ano = dataExt.substr(6, 4);
            let mesExtenso;

            //Percorro pelo m√™s e o apresento pelo nome do m√™s.
            switch (mes) {
              case mes     = "01":
                mesExtenso = 'Janeiro';
                break;
              case mes     = "02":
                mesExtenso = 'Fevereiro';
                break;
              case mes     = "03":
                mesExtenso = 'Mar√ßo';
                break;
              case mes     = "04":
                mesExtenso = 'Abril';
                break;
              case mes     = "05":
                mesExtenso = 'Maio';
                break;
              case mes     = "06":
                mesExtenso = 'Junho';
                break;
              case mes     = "07":
                mesExtenso = 'Julho';
                break;
              case mes     = "08":
                mesExtenso = 'Agosto';
                break;
              case mes     = "09":
                mesExtenso = 'Setembro';
                break;
              case mes     = "10":
                mesExtenso = 'Outubro';
                break;
              case mes     = "11":
                mesExtenso = 'Novembro';
                break;
              case mes     = "12":
                mesExtenso = 'Dezembro';
                break;
            }

            //Coloco a data tratada em uma vari√°vel
            let dataTratada = dia + ' ' + 'de' + ' ' + mesExtenso + ' ' + 'de' + ' ' + ano;

            /* Fim tratando data */

            /* Criando arquitetura de exibi√ß√£o dos dados. [Inicio]*/
            var divPostContainer = document.createElement('div');
            divPostContainer.className = 'post-container';

            var divPost = document.createElement('div');
            divPost.className = 'post';

            var dateP = document.createElement('p');
            dateP.className = 'date';
            dateP.innerHTML = dataTratada;

            var postBr = document.createElement('br');
            var tituloPost = document.createElement('h1');
            tituloPost.innerHTML = element.titulo;

            var contentPost = document.createElement('div');
            contentPost.className = 'post-content';

            var conteudoSaltaLinha = document.createElement('br');
            var conteudoParagrafo  = document.createElement('p');
            var conteudoUnderLine  = document.createElement('hr');
            var btnAtualiza        = document.createElement('btn');
            var btnDeleta          = document.createElement('btn');
           
            //DIV de a√ß√µes [Inicio]
            var contentAcoes = document.createElement('div');
            contentAcoes.className = 'Acoes';
            btnAtualiza.className  = 'btnAcoesAtualiza';

            
            btnAtualiza.addEventListener('click', function atualizar(){
              closeModalNew();
              openModalUpdate();
              alert(element.id);
              get(child(dbRef, 'Postagens/' + element.id)).then((snapshot) => {
                    if (snapshot.exists()) {
                     // nome.value = snapshot.val().nome.data;
                      console.log(snapshot.val().titulo);
                      console.log(snapshot.val().data);
                      console.log(snapshot.val().conteudo);

                    } else {
                      alert("Employee does not exists");
                    }
                  }).catch((error) => {
                    alert("Sem sucesso!");
                    console.log(error);
                  })              
            });

            btnDeleta.className  = 'btnAcoesDeleta';
            btnDeleta.addEventListener('click', function atualizar(){
              closeModalNew();
              closeModalUpdate();
              alert('OI do click DELETE' + ' _ ' + element.id);
            });

            //DIV de a√ß√µes [Inicio]

            conteudoParagrafo.innerHTML = element.conteudo;
            /* Criando arquitetura de exibi√ß√£o dos dados. [Fim]*/

            /* Montando no DOM a estrutura criada [Inicio] */
            document.getElementById('contentPost').appendChild(divPost);
            divPost.appendChild(dateP);
            divPost.appendChild(postBr);
            divPost.appendChild(contentAcoes);
            contentAcoes.appendChild(btnAtualiza);
            contentAcoes.appendChild(btnDeleta);
            divPost.appendChild(tituloPost);
            divPost.appendChild(contentPost);
            contentPost.appendChild(conteudoSaltaLinha);
            contentPost.appendChild(conteudoParagrafo);
            contentPost.appendChild(conteudoUnderLine);
            /* Montando no DOM a estrutura criada [Fim] */

          });
       });
    },false);

    btn.addEventListener('click', addData);
   // btnRet.addEventListener('click', RetData());

  </script>
</body>

</html>