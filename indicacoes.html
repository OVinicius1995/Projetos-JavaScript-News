<!DOCTYPE html>
<html lang="pt-Br">

<head>
  <meta charset="UTF-8">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="./styleIndicacoes.css">
  <link rel="shortcut icon" href="./Assets/M.ico" type="image/x-icon">

  <title>Lista de indica√ß√µes</title>
</head>
<!-- Script que fixa os bot√µes no topo da pagina ao rolar a p√°gina.[Inicio] 
<script type="text/javascript">
  window.onscroll = scroll;
  function scroll() {
    var nVScroll = document.documentElement.scrollTop || document.body.scrollTop; if (nVScroll > 10) {
      document.getElementById("item1").classList.add('menuFixo');
      document.getElementById("searchBar").classList.add('searchBarfix')
    } else {

      document.getElementById("item1").classList.remove('menuFixo');
      document.getElementById("searchBar").classList.remove('searchBarfix');

    }

  }

  /* Script que fixa os bot√µes no topo da pagina ao rolar a p√°gina.[Fim] */

</script>
-->

<body>

  <section class="container" id="loading">

    <header class="header-content" id="top">

      <div>
        <img class="imgHeader" src="./Assets/LogoMeet-New.png" alt="" srcset="">
      </div>
      
      <div class="title">
        <h1>Meet <span>News</span>üóûÔ∏è</h1>
      </div>
      
      <div class="header-btn">
        <button class="btn btnNoticias"><a href="./index.html">Noticias</a></button>
        <button class="btn btnAssembleias">Assembleias</button>
        <button class="btn btnPaterns">Manuais</button>
      </div>
      

    </header>

    <main class="main-content">


      <div class="itens item2">

        <button class="addBtn" onclick="openModalNew(),closeModalUpdate(),loadingHide()"><img src="./Assets/btnAdd32.png" alt=""
            srcset=""></button>

        <!-- Modal para adicionar as indica√ß√µes [Inicio] -->
        <div class="modalContent" id="showModal">
          <div class="modalAddNews" id="modalAddNews">

            <div class="btnClose" onclick="openModalNew()"><img src="./Assets/close.png" alt="" srcset=""></div>

            <h1>Inserir Indica√ß√µes</h1>

            <input id="data" type="date" name="data" placeholder="Informe a data">

            <label for="nome">Informe o nome:</label>
            <input id="nome" type="ext" placeholder="Informe o nome da indica√ß√£o">
            
            <label for="telefone">Informe o telefone (DD)0000-0000:</label>
            <input id="telefone" type="tel" placeholder="Informe o telefone da indica√ß√£o">

            <label for="conteudo">Informe uma descri√ß√£o para indica√ß√£o:</label>
            <textarea id="conteudo" name="story" rows="20" cols="40"
              placeholder="Informe uma breve descri√ß√£o, os contatos, etc..."></textarea>

            <select name="classificacao" id="classificacoes" class="categoriasCmb">

              <option value="Escolha" selected>Escolha um classifica√ß√£o:</option>
              <option value="1">1 Estrelinha</option>
              <option value="2">2 Estrelinhas</option>
              <option value="3">3 Estrelinhas</option>
              <option value="4">4 Estrelinhas</option>
              <option value="5">5 Estrelinhas</option>

            </select>
         
            <select name="categoria" id="categorias" class="categoriasCmb">

              <option value="Escolha" selected>Escolha um op√ß√£o:</option>

              <option value="Refrigeracao">Instalador de ar cond.</option>
              <option value="Bombeiro">Bombeiro</option>
              <option value="Chaveiro">Chaveiro</option>
              <option value="Costureira">Costureira</option>
              <option value="Consertos">Consertos em geral</option>
              <option value="Confeiteiras">Confeiteiras</option>
              <option value="Diaristas">Diaristas</option>
              <option value="Estofados">Estofados</option>
              <option value="Festas">Festas</option>
              <option value="Gesseiro">Gesseiro</option>
              <option value="Jardinagem">Jardinagem</option>
              <option value="Pedreiro">Pedreiro</option>
              <option value="Pintor">Pintor</option>
              <option value="Marceneiro">Marceneiro</option>
              <option value="Massagista">Massagista</option>
              <option value="Manicure">Manicure</option>
              <option value="Montador">Montador de moveis</option>
              <option value="Mudan√ßa">Mudan√ßa</option>
              <option value="Odonto">Odonto</option>
              <option value="Reciclagem">Reciclagem</option>
              <option value="Telas">Telas de prote√ß√£o</option>
              <option value="Vidraceiro">Vidraceiro</option>
            </select>

            <div class="adicionar">
              <button id="AddBtn" class="btn">Adicionar</button>
            </div>
          </div>
        </div>
        <!-- Modal para adicionar as noticias na tela [Fim] -->

        <!-- Modal para corrigir as indica√ß√µes [Inicio] -->
        <div class="modalContent" id="showModalCorrigir">
          <div class="modalAddNews">

            <div class="btnClose" onclick="openModalUpdate()"><img src="./Assets/close.png" alt="" srcset=""></div>

            <h1>Atualizar indica√ß√µes</h1>

            <input id="dataUpd" type="date">

            <label for="nomeUpd">Informe o nome:</label>            
            <input id="nomeUpd" type="text" placeholder="Informe o t√≠tulo">

            <label for="telefoneUpd">Informe o telefone (DD)0000-0000:</label>
            <input id="telefoneUpd" type="ext" placeholder="Informe o telefone da indica√ß√£o">

            <label for="conteudo">Informe uma descri√ß√£o para indica√ß√£o:</label>
            <textarea id="conteudoUpd" name="story" rows="20" cols="40" placeholder="Informe o conte√∫do."></textarea>

            <select name="classificacao" id="classificacoesUpd" class="categoriasCmb">

              <option value="Escolha">Escolha um classifica√ß√£o:</option>
              <option value="1">1 Estrelinha</option>
              <option value="2">2 Estrelinhas</option>
              <option value="3">3 Estrelinhas</option>
              <option value="4">4 Estrelinhas</option>
              <option value="5">5 Estrelinhas</option>

            </select>
         
            <select name="categoria" id="categoriasUpd" class="categoriasCmb">
              <option value="Refrigeracao">Instalador de ar cond.</option>
              <option value="Bombeiro">Bombeiro</option>
              <option value="Chaveiro">Chaveiro</option>
              <option value="Costureira">Costureira</option>
              <option value="Consertos">Consertos em geral</option>
              <option value="Confeiteiras">Confeiteiras</option>
              <option value="Diaristas">Diaristas</option>
              <option value="Estofados">Estofados</option>
              <option value="Festas">Festas</option>
              <option value="Gesseiro">Gesseiro</option>
              <option value="Jardinagem">Jardinagem</option>
              <option value="Pedreiro">Pedreiro</option>
              <option value="Pintor">Pintor</option>
              <option value="Marceneiro">Marceneiro</option>
              <option value="Massagista">Massagista</option>
              <option value="Manicure">Manicure</option>
              <option value="Montador">Montador de moveis</option>
              <option value="Mudan√ßa">Mudan√ßa</option>
              <option value="Odonto">Odonto</option>
              <option value="Reciclagem">Reciclagem</option>
              <option value="Telas">Telas de prote√ß√£o</option>
              <option value="Vidraceiro">Vidraceiro</option>
            </select>

            <div class="adicionar">
              <button id="UpdateBtn" class="btn">Atualizar noticias</button>

            </div>
          </div>
        </div>

        <!-- Modal para corrigir as indica√ß√µes na tela [Fim] -->

        <!-- √Årea do conte√∫do da p√°gina -->
        <div id="contentPost" class="post-container"></div>

      </div>

      <div class="itens item3" id="searchBar">
        <div class="search-content">

          <input list="cat" class="inptSearch" name="search" id="search" type="search" placeholder="Pesquisar por categorias...">
          <datalist id="cat">
            
            <option value="Bombeiro">
            <option value="Chaveiro">
            <option value="Costureira">
            <option value="Consertos em geral">
            <option value="Confeiteiras">
            <option value="Diaristas">
            <option value="Estofados">
            <option value="Festas">
            <option value="Gesseiro">
            <option value="Jardinagem">
            <option value="Pedreiro">
            <option value="Pintor">
            <option value="Marceneiro">
            <option value="Manicure">
            <option value="Massagista">
            <option value="Montador de moveis">
            <option value="Mudan√ßa">
            <option value="Odonto">
            <option value="Reciclagem">
            <option value="Refrigeracao">
            <option value="Telas de prote√ß√£o">
            <option value="Vidraceiro">
          </datalist>

          <a class="search-btn">
            <img class="loupe-blue" src="./Assets/loupe-blue.svg" alt="" width="15px" height="15px">
            <img id="searchBtn" class="loupe-white" src="./Assets/loupe-white.svg" alt="" width="15px" height="15px">

          </a>

        </div>

          <p id="limpar" class="limpar">Limpar pesquisa.</p>
        </div>
        <div class="filter-selector">
          
          <input
            type="checkbox"
            id="switch"
            onchange="onFilterChange()"
            value="marcado"
          />
          <label for="switch" class="switch">Toggle</label>
        </div>
        <div>
      </div>

    </main>

    <footer class="footer-content">

      <div>
        <p>Made with 
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#f64348" stroke="#f64348" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg> 
            by <a href="https://github.com/OVinicius1995/" id="devFooter" target="_blank">Vin√≠cius Oliveira</a> &copy; 
        </p>
      </div>
      <div></div>
      <div><a href="#top" id="backtotop"> Voltar ao topo <img src="./Assets/seta-para-cima.png" alt="Setinha para o topo" width="20" height="20"> </a> </div>

    </footer>

  </section>
  <script src="./funcoesIndicacoes.js">

  </script>

  <script type="module">

    // Importa√ß√£o de componentes do banco de dados
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { query, getDatabase, ref, child, get, set, update, remove, orderByKey, orderByChild } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
    import { orderByValue, limitToLast, limitToFirst, equalTo, startAt } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

    // Configura√ß√µes da conex√£o do banco de dados
    const firebaseConfig = {
      apiKey: "AIzaSyBxnFt-BFIPOzLBHGIKCO2OZgNCpx0Ufbo",
      authDomain: "meetnews-1c4bf.firebaseapp.com",
      projectId: "meetnews-1c4bf",
      storageBucket: "meetnews-1c4bf.appspot.com",
      messagingSenderId: "623938736140",
      appId: "1:623938736140:web:5cd1c5529f81c793e15e29"
    };

    // Realiza a conex√£o com o banco
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();

    // Carrega as os compenentes nas vari√°veis
    let telefoneUpd  = document.getElementById('telefoneUpd');
    let telefone     = document.getElementById('telefone');
    let classific    = document.getElementById('classificacoes');
    let classificUpd = document.getElementById('classificacoesUpd');
    let conteudoUpd  = document.getElementById('conteudoUpd');
    let data         = document.getElementById("data");
    let nome         = document.getElementById('nome');
    let conteudo     = document.getElementById('conteudo');
    let nomeUpd      = document.getElementById('nomeUpd');
    let dataUpd      = document.getElementById('dataUpd');
    let btn          = document.getElementById('AddBtn');
    let btnUpd       = document.getElementById('UpdateBtn');
    let btnSeacrh    = document.getElementById('searchBtn');
    let btnLimpar    = document.getElementById('limpar');

    var idIndicacoesUpd;
    var idIndicacoesDel;
    var nomeAtual;
    var conteudoAtual;
    var categoriaAtual;
    var telefoneAtual;
    var classificAtual;
    var avaliacaoAtual;
    var dataAtual;
    var lastId = 0;
    let nomeAlteraClassific;
    let justicativaAlteracao;
    var filterclassificacoes = [];
    let choice;


    //Fun√ß√£o que grava os dados no banco.
    function addData() {

      let incrementedId = parseInt(lastId) + parseInt(1);

      if (data.value === "" || nome.value === "" || conteudo.value === "" || categorias.value === "Escolha" || classific.value === "Escolha" || telefone ===""  ) {
        alert("Alguns dados n√£o foram preenchidos, ou foram preenchido de forma errada, todos eles s√£o obrigat√≥rios verifique!");
      } else {

        let dataFormatada = (new Date(data.value)).toISOString().match(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/)[0].split('-').reverse().join('/');

        set(ref(db, 'Indicacoes/' + incrementedId), {
          id: incrementedId,
          data: dataFormatada,
          nomeIndica: nome.value,
          conteudo: conteudo.value,
          categoria: categorias.value,
          telefone: telefone.value,
          classificacao: parseInt(classific.value)

        }).then(() => {
          alert("Indica√ß√£o gravada com sucesso!");
          window.location.reload(true);
        }).catch(() => {
          alert("N√£o gravou! Verifique.");
        })
      }
    }
    //Fun√ß√£o que atualiza os dados no banco.
    function atualizarDados() {

      let dataFormatada = (new Date(dataUpd.value)).toISOString().match(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/)[0].split('-').reverse().join('/');

      if (nomeUpd.value === "" || conteudoUpd.value === "") {      
        alert("Nome a ser corrigido, ou o conte√∫do ficou em branco verifique!");
      } if (classificacoesUpd.value < classificAtual) {

        const confirmacao = confirm("Voc√™ escolheu um valor menor, ent√£o se faz necess√°rio uma justicativa para a altera√ß√£o.");
        
        if (confirmacao) {
          nomeAlteraClassific  = prompt("Por gentiliza identifique-se, seu Nome: ");
          justicativaAlteracao = prompt("Informe o motivo de sua altera√ß√£o.");  

          update(ref(db, 'Indicacoes/' + idIndicacoesUpd), {

          data: dataFormatada,
          nomeIndica: nomeUpd.value,
          conteudo: conteudoUpd.value,
          categoria: categoriasUpd.value,
          telefone: telefoneUpd.value,
          classificacao: parseInt(classificacoesUpd.value)

        }).then(() => {

        if (dataAtual != dataUpd.value) {
          alert("Data atualizada com sucesso!");
        }

        if (telefoneAtual != telefoneUpd.value) {
          alert("Telefone atualizado com sucesso!");
        }

        if (classificAtual != classificUpd.value) {
          alert("Classifica√ß√£o atualizada com sucesso!");
        }

        if (nomeAtual != nomeUpd.value) {
          alert("Nome atualizado com sucesso!");
        }

        if (conteudoAtual != conteudoUpd.value) {
          alert("Conteudo atualizado com sucesso!");
        }

        if (categoriaAtual != categoriasUpd.value) {
          alert("Categoria atualizada com sucesso!");
        }
        // alert("Noticia atualizada com sucesso!");
        window.location.reload(true);
        }).catch(() => {
        alert("N√£o gravou! Verifique.");
        })

        } else {
          alert("Cancelando altera√ß√£o...");
        }
                
      }
      else {
        update(ref(db, 'Indicacoes/' + idIndicacoesUpd), {

          data: dataFormatada,
          nomeIndica: nomeUpd.value,
          conteudo: conteudoUpd.value,
          categoria: categoriasUpd.value,
          telefone: telefoneUpd.value,
          classificacao: parseInt(classificacoesUpd.value)
          
        }).then(() => {

          if (dataAtual != dataUpd.value) {
            alert("Data atualizada com sucesso!");
          }

          if (telefoneAtual != telefoneUpd.value) {
            alert("Telefone atualizado com sucesso!");
          }

          if (classificAtual != classificUpd.value) {
            alert("Classifica√ß√£o atualizada com sucesso!");
          }

          if (nomeAtual != nomeUpd.value) {
            alert("Nome atualizado com sucesso!");
          }

          if (conteudoAtual != conteudoUpd.value) {
            alert("Conteudo atualizado com sucesso!");
          }

          if (categoriaAtual != categoriasUpd.value) {
            alert("Categoria atualizada com sucesso!");
          }
          // alert("Noticia atualizada com sucesso!");
          window.location.reload(true);
        }).catch(() => {
          alert("N√£o gravou! Verifique.");
        })
      }
    }
    //Fun√ß√£o que deleta os dados no banco.
    function deletarDados() {

      remove(ref(db, 'Indicacoes/' + idIndicacoesDel))
        .then(() => {
          alert("Noticia deletada com sucesso!");
          window.location.reload(true);
        }).catch(() => {
          alert("N√£o deletou! Verifique.");
        })

    }

    //Classifica do melhor avaliado para o pior avaliado.
    function classificarIndicacoes(){
    //  alert("Chamou!!!");//classificacao

    loadingShow();      

      var limpaConteudo = document.getElementById('contentPost');
      while (limpaConteudo.firstChild) {
        limpaConteudo.removeChild(limpaConteudo.firstChild);
      }

      let inptSearch;
      inptSearch = document.getElementById('search').value;

      //Constantes que recebem o banco de dados.
      const dbRef = ref(db);
      const searchPostsRef = query(ref(db, 'Indicacoes/'));
      get(searchPostsRef)
        .then((snapshot) => {

          //Crio um array que receber√° os valores recebidos do banco.
          var ids            = [];
          var indicacoes     = [];
          
          
          //Percorro o objeto recebido.
          snapshot.forEach(childSnapshot => {
            //Adiciono os dados no array.  
          //  indicacoes.push(childSnapshot.val());
            filterclassificacoes.push(childSnapshot.val());
          //  ids.push(childSnapshot.val());
          });

                
       filterclassificacoes.sort(function (a,b) {
        return a.classificacao - b.classificacao;
      });

      console.log(filterclassificacoes);
     // alert(reduceOfClassific);

          if (filterclassificacoes.length > 0) {
            loadingHide();
          }

          filterclassificacoes.forEach(recebeId => {
            lastId = recebeId.id;
          })

          //Nessa parte eu inverto o array como se fosse um order by desc.
          filterclassificacoes.reverse();
          filterclassificacoes.forEach(element => {

            /* Tratando data [Inicio]. */
            let dataExt = element.data;
            //Extraindo dia m√™s e ano da data  
            let dia = dataExt.slice(0, 2);
            let mes = dataExt.substr(3, 2);
            let ano = dataExt.substr(6, 4);
            let mesExtenso;

            /*Telefone tratado*/
            let telefoneTratado = element.telefone;
             


            //Passando os meses para extenso [Inicio]
            if (mes === "01") { mesExtenso = "Janeiro" }
            if (mes === "02") { mesExtenso = "Fevereiro" }
            if (mes === "03") { mesExtenso = "Mar√ßo" }
            if (mes === "04") { mesExtenso = "Abril" }
            if (mes === "05") { mesExtenso = "Maio" }
            if (mes === "06") { mesExtenso = "Junho" }
            if (mes === "07") { mesExtenso = "Julho" }
            if (mes === "08") { mesExtenso = "Agosto" }
            if (mes === "09") { mesExtenso = "Setembro" }
            if (mes === "10") { mesExtenso = "Outubro" }
            if (mes === "11") { mesExtenso = "Novembro" }
            if (mes === "12") { mesExtenso = "Dezembro" }

           
            let dataTratada = dia + ' ' + 'de' + ' ' + mesExtenso + ' ' + 'de' + ' ' + ano;

            //Trata os meses [Fim]

            /* Criando arquitetura de exibi√ß√£o dos dados. [Inicio]*/
            var divPostContainer = document.createElement('div');
            divPostContainer.className = 'post-container';


            //DIV Postagem
            var divPost = document.createElement('div');
            divPost.className = 'post';

            var dateP = document.createElement('p');
            dateP.className = 'date';
            dateP.innerHTML = dataTratada;

            var postBr = document.createElement('br');
            var tituloPost = document.createElement('h1');
            tituloPost.innerHTML = element.nomeIndica + " - " + element.telefone;


            //div conteudo
            var contentPost = document.createElement('div');
            contentPost.className = 'post-content';
            

            var categoria = document.createElement('div');
            categoria.className = 'categorias';
            var nomeCategoria = document.createElement('p');
            nomeCategoria.innerHTML = element.categoria;


            function addStars(star){
              switch(star){
                case 1:
                  return "‚≠ê"
                break
                case 2:
                  return "‚≠ê‚≠ê"
                break
                case 3:
                  return "‚≠ê‚≠ê‚≠ê"
                break
                case 4:
                  return "‚≠ê‚≠ê‚≠ê‚≠ê"
                break
                case 5:
                  return "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"
                break
                default:
                return "Ainda n√£o foi avaliado."
                break
              }
            }
            
            var classificacaoStar = document.createElement('div');
            classificacaoStar.className = 'conteudoAval';
            classificacaoStar.innerText = "Esse prestador recebeu a avalia√ß√£o de: "
            + addStars(element.classificacao) + "(" + element.classificacao + ")"

            
            var conteudoSaltaLinha = document.createElement('br');
            
            var conteudoParagrafo = document.createElement('div');      
            var conteudoUnderLine = document.createElement('hr');
            var btnAtualiza = document.createElement('btn');
            var btnDeleta = document.createElement('btn');


            //DIV de a√ß√µes [Inicio]
            var contentAcoes = document.createElement('div');
            contentAcoes.className = 'Acoes';
            btnAtualiza.className = 'btnAcoesAtualiza';

            //Associa o evento de click ao bot√£o de atualiza√ß√£o
            btnAtualiza.addEventListener('click', function atualizar() {
              closeModalNew();
              openModalUpdate();

              let dataExtTeste = element.data;
              //Extraindo o dia da data  
              let dia = dataExtTeste.slice(0, 2);
              let mes = dataExtTeste.substr(3, 2);
              let ano = dataExtTeste.substr(6, 4);

              idIndicacoesUpd = element.id;

              get(child(dbRef, 'Indicacoes/' + element.id)).then((snapshot) => {
                if (snapshot.exists()) {
                  //  let dataFormatadaUpd = (new Date(snapshot.val().data)).toISOString().match(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/)[0].split("-").reverse().join('/');
                  document.getElementById('dataUpd').value             = ano + "-" + mes + "-" + dia; //snapshot.val().data;
                  document.getElementById('nomeUpd').value             = snapshot.val().nomeIndica;
                  document.getElementById('telefoneUpd').value         = snapshot.val().telefone;
                  document.getElementById('classificacoesUpd').value   = snapshot.val().classificacao;
                  document.getElementById('conteudoUpd').value         = snapshot.val().conteudo;
                  document.getElementById('categoriasUpd').value       = snapshot.val().categoria;
                  
                  dataAtual      = ano + "-" + mes + "-" + dia;
                  nomeAtual      = snapshot.val().nomeIndica;
                  conteudoAtual  = snapshot.val().conteudo;
                  categoriaAtual = snapshot.val().categoria;
                  telefoneAtual  = snapshot.val().telefone;
                  classificAtual = snapshot.val().classificacao;
                  
                } else {
                  alert("Nenhum registro encontrado.");
                }
              }).catch((error) => {
                alert("Sem sucesso!");
                console.log(error);
              })
            });

            //Associa o evento de click ao bot√£o de dele√ß√£o
            btnDeleta.className = 'btnAcoesDeleta';
            btnDeleta.addEventListener('click', function deletar() {
              closeModalNew();
              closeModalUpdate();
              
              idIndicacoesDel = element.id;

              deletarDados();
            });

            //DIV de a√ß√µes [Fim]

            conteudoParagrafo.innerHTML = element.conteudo;
            /* Criando arquitetura de exibi√ß√£o dos dados. [Fim]*/

            /* Montando no DOM a estrutura criada [Inicio] */
            document.getElementById('contentPost').appendChild(divPost);
            divPost.appendChild(dateP);
            divPost.appendChild(postBr);
            divPost.appendChild(contentAcoes);
            contentAcoes.appendChild(btnAtualiza);
            contentAcoes.appendChild(btnDeleta);

            divPost.appendChild(tituloPost);
            divPost.appendChild(postBr);
            divPost.appendChild(contentPost);
            
           
            contentPost.appendChild(conteudoParagrafo);
          

            contentPost.appendChild(classificacaoStar);

            contentPost.appendChild(categoria);            
            categoria.appendChild(nomeCategoria);            
            contentPost.appendChild(conteudoUnderLine);

            /* Montando no DOM a estrutura criada [Fim] */

          });
         // console.log(indicacoes);
        });

    }
    //Habilitar pesquisa com a tecla enter

    function pesquisarFiltro() {
      let inptSearch;
      inptSearch = document.getElementById('search').value;

      if (inptSearch === "") {

        alert("N√£o foi informada nenhuma categoria, verifique!");

        //Constantes que recebem o banco de dados.
        const dbRef = ref(db);
        const searchPostsRef = query(ref(db, 'Indicacoes/'));
        get(searchPostsRef)
          .then((snapshot) => {

            var limpaConteudo = document.getElementById('contentPost');
            while (limpaConteudo.firstChild) {
              limpaConteudo.removeChild(limpaConteudo.firstChild);
            }

            //Crio um array que receber√° os valores recebidos do banco.
            var indicacoes = [];
            var ids = [];

            //Percorro o objeto recebido.
            snapshot.forEach(childSnapshot => {
              //Adiciono os dados no array.  
              indicacoes.push(childSnapshot.val());
              ids.push(childSnapshot.val());
            });


            indicacoes.forEach(recebeId => {
              lastId = recebeId.id;
            })

            //Nessa parte eu inverto o array como se fosse um order by desc.
            indicacoes.reverse();
            indicacoes.forEach(element => {

              /* Tratando data [Inicio]. */
              let dataExt = element.data;
              //Extraindo dia m√™s e ano da data  
              let dia = dataExt.slice(0, 2);
              let mes = dataExt.substr(3, 2);
              let ano = dataExt.substr(6, 4);
              let mesExtenso;

              //Passando os meses para extenso [Inicio]
              if (mes === "01") { mesExtenso = "Janeiro" }
              if (mes === "02") { mesExtenso = "Fevereiro" }
              if (mes === "03") { mesExtenso = "Mar√ßo" }
              if (mes === "04") { mesExtenso = "Abril" }
              if (mes === "05") { mesExtenso = "Maio" }
              if (mes === "06") { mesExtenso = "Junho" }
              if (mes === "07") { mesExtenso = "Julho" }
              if (mes === "08") { mesExtenso = "Agosto" }
              if (mes === "09") { mesExtenso = "Setembro" }
              if (mes === "10") { mesExtenso = "Outubro" }
              if (mes === "11") { mesExtenso = "Novembro" }
              if (mes === "12") { mesExtenso = "Dezembro" }

              let dataTratada = dia + ' ' + 'de' + ' ' + mesExtenso + ' ' + 'de' + ' ' + ano;

              //Trata os meses [Fim]

              /* Criando arquitetura de exibi√ß√£o dos dados. [Inicio]*/
              var divPostContainer = document.createElement('div');
              divPostContainer.className = 'post-container';

              var divPost = document.createElement('div');
              divPost.className = 'post';

              var dateP = document.createElement('p');
              dateP.className = 'date';
              dateP.innerHTML = dataTratada;

              var postBr = document.createElement('br');
              var tituloPost = document.createElement('h1');
              tituloPost.innerHTML = element.nomeIndica;

              var contentPost = document.createElement('div');
              contentPost.className = 'post-content';

              var categoria = document.createElement('div');
              categoria.className = 'categorias';
              var nomeCategoria = document.createElement('p');
              nomeCategoria.innerHTML = element.categoria;

              var conteudoSaltaLinha = document.createElement('br');
              var conteudoParagrafo = document.createElement('p');
              var conteudoUnderLine = document.createElement('hr');
              var btnAtualiza = document.createElement('btn');
              var btnDeleta = document.createElement('btn');

              //DIV de a√ß√µes [Inicio]
              var contentAcoes = document.createElement('div');
              contentAcoes.className = 'Acoes';
              btnAtualiza.className = 'btnAcoesAtualiza';

              //Associa o evento de click ao bot√£o de atualiza√ß√£o
              btnAtualiza.addEventListener('click', function atualizar() {
                closeModalNew();
                openModalUpdate();

                let dataExtTeste = element.data;
                //Extraindo o dia da data  
                let dia = dataExtTeste.slice(0, 2);
                let mes = dataExtTeste.substr(3, 2);
                let ano = dataExtTeste.substr(6, 4);

                idIndicacoesUpd = element.id;

                get(child(dbRef, 'Indicacoes/' + element.id)).then((snapshot) => {
                  if (snapshot.exists()) {
                    
                    document.getElementById('dataUpd').value = ano + "-" + mes + "-" + dia; 
                    document.getElementById('nomeUpd').value = snapshot.val().nomeIndica;
                    document.getElementById('conteudoUpd').value = snapshot.val().conteudo;
                    document.getElementById('categoriasUpd').value = snapshot.val().categoria;
                    dataAtual = ano + "-" + mes + "-" + dia;
                    nomeAtual = snapshot.val().nomeIndica;
                    conteudoAtual = snapshot.val().conteudo;
                    categoriaAtual = snapshot.val().categoria;

                  } else {
                    alert("Nenhum registro encontrado.");
                  }
                }).catch((error) => {
                  alert("Sem sucesso!");
                  console.log(error);
                })
              });

              //Associa o evento de click ao bot√£o de dele√ß√£o
              btnDeleta.className = 'btnAcoesDeleta';
              btnDeleta.addEventListener('click', function deletar() {
                closeModalNew();
                closeModalUpdate();

                idInidicacoesDel = element.id;

                deletarDados();
              });

              //DIV de a√ß√µes [Fim]

              conteudoParagrafo.innerHTML = element.conteudo;
              /* Criando arquitetura de exibi√ß√£o dos dados. [Fim]*/

              /* Montando no DOM a estrutura criada [Inicio] */
              document.getElementById('contentPost').appendChild(divPost);
              divPost.appendChild(dateP);
              divPost.appendChild(postBr);
              divPost.appendChild(contentAcoes);
              contentAcoes.appendChild(btnAtualiza);
              contentAcoes.appendChild(btnDeleta);
              divPost.appendChild(tituloPost);
              divPost.appendChild(contentPost);
              contentPost.appendChild(conteudoSaltaLinha);
              contentPost.appendChild(conteudoParagrafo);
              contentPost.appendChild(conteudoSaltaLinha);
              contentPost.appendChild(categoria);
              categoria.appendChild(nomeCategoria);
              contentPost.appendChild(conteudoUnderLine);
              /* Montando no DOM a estrutura criada [Fim] */

            });
          });
      } else {

        var limpaConteudo = document.getElementById('contentPost');
        while (limpaConteudo.firstChild) {
          limpaConteudo.removeChild(limpaConteudo.firstChild);
        }


        btnLimpar.classList.add("limparText");

        let primeiraLetraMiusculo = inptSearch[0].toUpperCase() + inptSearch.substring(1);

        //Constantes que recebem o banco de dados.
        const dbRef = ref(db);
        const searchPostsRef = query(ref(db, 'Indicacoes/'), orderByChild("categoria"), equalTo(primeiraLetraMiusculo));
        get(searchPostsRef)
          .then((snapshot) => {

            if (snapshot.exists()) {

              //Crio um array que receber√° os valores recebidos do banco.
              var indicacoes = [];
              var ids = [];

              //Percorro o objeto recebido.
              snapshot.forEach(childSnapshot => {
                //Adiciono os dados no array.  
                indicacoes.push(childSnapshot.val());
                ids.push(childSnapshot.val());
              });


              indicacoes.forEach(recebeId => {
                lastId = recebeId.id;
              })

              //Nessa parte eu inverto o array como se fosse um order by desc.
              indicacoes.reverse();
              indicacoes.forEach(element => {

                /* Tratando data [Inicio]. */
                let dataExt = element.data;
                //Extraindo dia m√™s e ano da data  
                let dia = dataExt.slice(0, 2);
                let mes = dataExt.substr(3, 2);
                let ano = dataExt.substr(6, 4);
                let mesExtenso;

                //Passando os meses para extenso [Inicio]
                if (mes === "01") { mesExtenso = "Janeiro" }
                if (mes === "02") { mesExtenso = "Fevereiro" }
                if (mes === "03") { mesExtenso = "Mar√ßo" }
                if (mes === "04") { mesExtenso = "Abril" }
                if (mes === "05") { mesExtenso = "Maio" }
                if (mes === "06") { mesExtenso = "Junho" }
                if (mes === "07") { mesExtenso = "Julho" }
                if (mes === "08") { mesExtenso = "Agosto" }
                if (mes === "09") { mesExtenso = "Setembro" }
                if (mes === "10") { mesExtenso = "Outubro" }
                if (mes === "11") { mesExtenso = "Novembro" }
                if (mes === "12") { mesExtenso = "Dezembro" }

                let dataTratada = dia + ' ' + 'de' + ' ' + mesExtenso + ' ' + 'de' + ' ' + ano;

                //Trata os meses [Fim]

                /* Criando arquitetura de exibi√ß√£o dos dados. [Inicio]*/
                var divPostContainer = document.createElement('div');
                divPostContainer.className = 'post-container';

                var divPost = document.createElement('div');
                divPost.className = 'post';

                var dateP = document.createElement('p');
                dateP.className = 'date';
                dateP.innerHTML = dataTratada;

                var postBr = document.createElement('br');
                var tituloPost = document.createElement('h1');
                tituloPost.innerHTML = element.nomeIndica;

                var contentPost = document.createElement('div');
                contentPost.className = 'post-content';

                var categoria = document.createElement('div');
                categoria.className = 'categorias';
                var nomeCategoria = document.createElement('p');
                nomeCategoria.innerHTML = element.categoria;

                var conteudoSaltaLinha = document.createElement('br');
                var conteudoParagrafo = document.createElement('p');
                var conteudoUnderLine = document.createElement('hr');
                var btnAtualiza = document.createElement('btn');
                var btnDeleta = document.createElement('btn');

                //DIV de a√ß√µes [Inicio]
                var contentAcoes = document.createElement('div');
                contentAcoes.className = 'Acoes';
                btnAtualiza.className = 'btnAcoesAtualiza';

                //Associa o evento de click ao bot√£o de atualiza√ß√£o
                btnAtualiza.addEventListener('click', function atualizar() {
                  closeModalNew();
                  openModalUpdate();

                  let dataExtTeste = element.data;
                  //Extraindo o dia da data  
                  let dia = dataExtTeste.slice(0, 2);
                  let mes = dataExtTeste.substr(3, 2);
                  let ano = dataExtTeste.substr(6, 4);

                  idIndicacoesUpd = element.id;

                  get(child(dbRef, 'Indicacoes/' + element.id)).then((snapshot) => {
                    if (snapshot.exists()) {
                      //  let dataFormatadaUpd = (new Date(snapshot.val().data)).toISOString().match(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/)[0].split("-").reverse().join('/');
                      document.getElementById('dataUpd').value = ano + "-" + mes + "-" + dia; //snapshot.val().data;
                      document.getElementById('nomeUpd').value = snapshot.val().nomeIndica;
                      document.getElementById('conteudoUpd').value = snapshot.val().conteudo;
                      document.getElementById('categoriasUpd').value = snapshot.val().categoria;
                      dataAtual = ano + "-" + mes + "-" + dia;
                      nomeAtual = snapshot.val().nomeIndica;
                      conteudoAtual = snapshot.val().conteudo;
                      categoriaAtual = snapshot.val().categoria;

                    } else {
                      alert("Nenhum registro encontrado.");
                    }
                  }).catch((error) => {
                    alert("Sem sucesso!");
                    console.log(error);
                  })
                });

                //Associa o evento de click ao bot√£o de dele√ß√£o
                btnDeleta.className = 'btnAcoesDeleta';
                btnDeleta.addEventListener('click', function deletar() {
                  closeModalNew();
                  closeModalUpdate();

                  idIndicacoesDel = element.id;

                  deletarDados();
                });

                //DIV de a√ß√µes [Fim]

                conteudoParagrafo.innerHTML = element.conteudo;
                /* Criando arquitetura de exibi√ß√£o dos dados. [Fim]*/

                /* Montando no DOM a estrutura criada [Inicio] */
                document.getElementById('contentPost').appendChild(divPost);
                divPost.appendChild(dateP);
                divPost.appendChild(postBr);
                divPost.appendChild(contentAcoes);
                contentAcoes.appendChild(btnAtualiza);
                contentAcoes.appendChild(btnDeleta);
                divPost.appendChild(tituloPost);
                divPost.appendChild(contentPost);
                contentPost.appendChild(conteudoSaltaLinha);
                contentPost.appendChild(conteudoParagrafo);
                contentPost.appendChild(conteudoSaltaLinha);
                contentPost.appendChild(categoria);
                categoria.appendChild(nomeCategoria);
                contentPost.appendChild(conteudoUnderLine);
                /* Montando no DOM a estrutura criada [Fim] */

              });
            } else {
              alert('Sua pesquisa n√£o retornou indica√ß√µes.');
            }
          }).catch((error) => {
            console.log('Nada encontrado 404!');
          });
      }
    }

    function limparPesquisa() {

      let inptSearch;
      inptSearch = document.getElementById('search').value;

      if (inptSearch === "") {

      } else {

        window.location.reload(true);
      }
    }
    
    function indicacoesSemClassificar() {
      loadingShow();      

      var limpaConteudo = document.getElementById('contentPost');
      while (limpaConteudo.firstChild) {
        limpaConteudo.removeChild(limpaConteudo.firstChild);
      }

      let inptSearch;
      inptSearch = document.getElementById('search').value;

      //Constantes que recebem o banco de dados.
      const dbRef = ref(db);
      const searchPostsRef = query(ref(db, 'Indicacoes/'));
      get(searchPostsRef)
        .then((snapshot) => {

          //Crio um array que receber√° os valores recebidos do banco.
          var ids            = [];
          var indicacoes     = [];
          
          
          //Percorro o objeto recebido.
          snapshot.forEach(childSnapshot => {
            //Adiciono os dados no array.  
            indicacoes.push(childSnapshot.val());
            filterclassificacoes.push(childSnapshot.val());
            ids.push(childSnapshot.val());
          });

          if (indicacoes.length > 0) {
            loadingHide();
          }

          indicacoes.forEach(recebeId => {
            lastId = recebeId.id;
          })

          //Nessa parte eu inverto o array como se fosse um order by desc.
          indicacoes.reverse();
          indicacoes.forEach(element => {

            /* Tratando data [Inicio]. */
            let dataExt = element.data;
            //Extraindo dia m√™s e ano da data  
            let dia = dataExt.slice(0, 2);
            let mes = dataExt.substr(3, 2);
            let ano = dataExt.substr(6, 4);
            let mesExtenso;

            //Passando os meses para extenso [Inicio]
            if (mes === "01") { mesExtenso = "Janeiro" }
            if (mes === "02") { mesExtenso = "Fevereiro" }
            if (mes === "03") { mesExtenso = "Mar√ßo" }
            if (mes === "04") { mesExtenso = "Abril" }
            if (mes === "05") { mesExtenso = "Maio" }
            if (mes === "06") { mesExtenso = "Junho" }
            if (mes === "07") { mesExtenso = "Julho" }
            if (mes === "08") { mesExtenso = "Agosto" }
            if (mes === "09") { mesExtenso = "Setembro" }
            if (mes === "10") { mesExtenso = "Outubro" }
            if (mes === "11") { mesExtenso = "Novembro" }
            if (mes === "12") { mesExtenso = "Dezembro" }

           
            let dataTratada = dia + ' ' + 'de' + ' ' + mesExtenso + ' ' + 'de' + ' ' + ano;

            //Trata os meses [Fim]

            /* Criando arquitetura de exibi√ß√£o dos dados. [Inicio]*/
            var divPostContainer = document.createElement('div');
            divPostContainer.className = 'post-container';


            //DIV Postagem
            var divPost = document.createElement('div');
            divPost.className = 'post';

            var dateP = document.createElement('p');
            dateP.className = 'date';
            dateP.innerHTML = dataTratada;

            var postBr = document.createElement('br');
            var tituloPost = document.createElement('h1');
            tituloPost.innerHTML = element.nomeIndica + " - " + element.telefone;


            //div conteudo
            var contentPost = document.createElement('div');
            contentPost.className = 'post-content';
            

            var categoria = document.createElement('div');
            categoria.className = 'categorias';
            var nomeCategoria = document.createElement('p');
            nomeCategoria.innerHTML = element.categoria;


            function addStars(star){
              switch(star){
                case 1:
                  return "‚≠ê"
                break
                case 2:
                  return "‚≠ê‚≠ê"
                break
                case 3:
                  return "‚≠ê‚≠ê‚≠ê"
                break
                case 4:
                  return "‚≠ê‚≠ê‚≠ê‚≠ê"
                break
                case 5:
                  return "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"
                break
              }
            }
            
            var classificacaoStar = document.createElement('div');
            classificacaoStar.innerText = "Esse prestador recebeu a avalia√ß√£o de: "
            + element.classificacao + " estrelas " + addStars(element.classificacao)

            
            var conteudoSaltaLinha = document.createElement('br');
            var conteudoParagrafo = document.createElement('p');
            var conteudoUnderLine = document.createElement('hr');
            var btnAtualiza = document.createElement('btn');
            var btnDeleta = document.createElement('btn');


            //DIV de a√ß√µes [Inicio]
            var contentAcoes = document.createElement('div');
            contentAcoes.className = 'Acoes';
            btnAtualiza.className = 'btnAcoesAtualiza';

            //Associa o evento de click ao bot√£o de atualiza√ß√£o
            btnAtualiza.addEventListener('click', function atualizar() {
              closeModalNew();
              openModalUpdate();

              let dataExtTeste = element.data;
              //Extraindo o dia da data  
              let dia = dataExtTeste.slice(0, 2);
              let mes = dataExtTeste.substr(3, 2);
              let ano = dataExtTeste.substr(6, 4);

              idIndicacoesUpd = element.id;

              get(child(dbRef, 'Indicacoes/' + element.id)).then((snapshot) => {
                if (snapshot.exists()) {
                  //  let dataFormatadaUpd = (new Date(snapshot.val().data)).toISOString().match(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/)[0].split("-").reverse().join('/');
                  document.getElementById('dataUpd').value             = ano + "-" + mes + "-" + dia; //snapshot.val().data;
                  document.getElementById('nomeUpd').value             = snapshot.val().nomeIndica;
                  document.getElementById('telefoneUpd').value         = snapshot.val().telefone;
                  document.getElementById('classificacoesUpd').value   = snapshot.val().classificacao;
                  document.getElementById('conteudoUpd').value         = snapshot.val().conteudo;
                  document.getElementById('categoriasUpd').value       = snapshot.val().categoria;
                  
                  dataAtual      = ano + "-" + mes + "-" + dia;
                  nomeAtual      = snapshot.val().nomeIndica;
                  conteudoAtual  = snapshot.val().conteudo;
                  categoriaAtual = snapshot.val().categoria;
                  telefoneAtual  = snapshot.val().telefone;
                  classificAtual = snapshot.val().classificacao;
                  
                } else {
                  alert("Nenhum registro encontrado.");
                }
              }).catch((error) => {
                alert("Sem sucesso!");
                console.log(error);
              })
            });

            //Associa o evento de click ao bot√£o de dele√ß√£o
            btnDeleta.className = 'btnAcoesDeleta';
            btnDeleta.addEventListener('click', function deletar() {
              closeModalNew();
              closeModalUpdate();
              
              idIndicacoesDel = element.id;

              deletarDados();
            });

            //DIV de a√ß√µes [Fim]

            conteudoParagrafo.innerHTML = element.conteudo;
            /* Criando arquitetura de exibi√ß√£o dos dados. [Fim]*/

            /* Montando no DOM a estrutura criada [Inicio] */
            document.getElementById('contentPost').appendChild(divPost);
            divPost.appendChild(dateP);
            divPost.appendChild(postBr);
            divPost.appendChild(contentAcoes);
            contentAcoes.appendChild(btnAtualiza);
            contentAcoes.appendChild(btnDeleta);

            divPost.appendChild(tituloPost);
            divPost.appendChild(postBr);
            divPost.appendChild(contentPost);
            
            contentPost.appendChild(conteudoSaltaLinha);
            contentPost.appendChild(conteudoParagrafo);
            contentPost.appendChild(conteudoSaltaLinha);
            contentPost.appendChild(categoria);            
            categoria.appendChild(nomeCategoria);
            contentPost.appendChild(classificacaoStar);
            contentPost.appendChild(conteudoUnderLine);

            /* Montando no DOM a estrutura criada [Fim] */

          });
         // console.log(indicacoes);
        });
    }
   
    
    //Habilitar pesquisa com a tecla enter
    const pesquisaComEnter = document.getElementById('search');
    pesquisaComEnter.addEventListener('keyup', function (e) {
      var key = e.which || e.keyCode;
      if (key == 13) { // codigo da tecla enter        
        pesquisarFiltro();
      }
    });


    //Fun√ß√£o que obtem os dados do banco e carrega na tela.
    document.addEventListener('DOMContentLoaded', () => {

     const theme = window.localStorage.getItem("theme");
     const checkbox = document.getElementById("switch");
     checkbox.checked = theme === "marcado";

     theme === "marcado" ? indicacoesSemClassificar() : classificarIndicacoes();

    });
       

    btn.addEventListener('click', addData);
    btnUpd.addEventListener('click', atualizarDados);
    btnSeacrh.addEventListener('click', pesquisarFiltro);
    btnLimpar.addEventListener('click', limparPesquisa);
    
</script>
</body>

</html>